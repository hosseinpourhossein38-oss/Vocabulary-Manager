{% extends 'base.html' %}
{% block title %}Goals - Vocabulary Manager{% endblock %}
{% block content %}
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-3">
    <h1 class="h4 m-0">Goals</h1>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h2 class="h5 m-0">Your Goals</h2>
          </div>

          {% if goals %}
            <div class="d-flex flex-column gap-3">
              {% for goal in goals %}
                <div class="card border-0">
                  <div class="card-body">
                    <div class="d-flex align-items-start justify-content-between gap-3">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-1">
                          <div class="fw-semibold">{{ goal.title }}</div>
                          {% if goal.category %}
                            <span class="badge text-bg-secondary">{{ goal.category }}</span>
                          {% endif %}
                          {% if not goal.is_active %}
                            <span class="badge text-bg-dark">Inactive</span>
                          {% endif %}
                        </div>
                        {% if goal.notes %}
                          <div class="text-muted small">{{ goal.notes }}</div>
                        {% endif %}
                      </div>
                      <div class="d-flex flex-wrap gap-2">
                        <a href="{{ url_for('log_time_form', goal_id=goal.id) }}" class="btn btn-primary btn-sm">Log Time</a>
                        <button onclick="editGoal({{ goal.id }}, '{{ goal.title }}', '{{ goal.category or '' }}', '{{ goal.notes or '' }}', {{ goal.is_active|lower }})" class="btn btn-outline-light btn-sm">Edit</button>
                        <form method="POST" action="{{ url_for('delete_goal', goal_id=goal.id) }}" onsubmit="return confirm('Are you sure you want to delete this goal?')">
                          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-muted">No goals created yet. Create your first goal using the form.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h5">Create New Goal</h2>
          <form method="POST" action="{{ url_for('create_goal') }}" id="goal-form" class="mt-3">
            <div class="mb-3">
              <label for="title" class="form-label">Title *</label>
              <input type="text" id="title" name="title" required class="form-control">
            </div>
            <div class="mb-3">
              <label for="category" class="form-label">Category</label>
              <input type="text" id="category" name="category" placeholder="e.g., Work, Health, Learning" class="form-control">
            </div>
            <div class="mb-3">
              <label for="notes" class="form-label">Notes</label>
              <textarea id="notes" name="notes" placeholder="Optional notes about this goal" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
              <label class="form-check-label" for="is_active">Active Goal</label>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary" id="submit-btn">Create Goal</button>
              <button type="button" class="btn btn-outline-light" id="cancel-btn" style="display: none;" onclick="resetForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    function editGoal(id, title, category, notes, isActive) {
      document.getElementById('goal-form').action = '{{ url_for("update_goal", goal_id=0) }}'.replace('0', id);
      document.querySelector('h2.h5').textContent = 'Edit Goal';
      document.getElementById('title').value = title;
      document.getElementById('category').value = category;
      document.getElementById('notes').value = notes;
      document.getElementById('is_active').checked = isActive;
      document.getElementById('submit-btn').textContent = 'Update Goal';
      document.getElementById('cancel-btn').style.display = 'inline-block';
    }
    function resetForm() {
      document.getElementById('goal-form').action = '{{ url_for("create_goal") }}';
      document.querySelector('h2.h5').textContent = 'Create New Goal';
      document.getElementById('goal-form').reset();
      document.getElementById('is_active').checked = true;
      document.getElementById('submit-btn').textContent = 'Create Goal';
      document.getElementById('cancel-btn').style.display = 'none';
    }
  </script>
{% endblock %}
